{"version":3,"sources":["functions.js"],"names":["_","Mavo","Functions","operators","get","obj","property","undefined","Array","isArray","isNaN","i","length","id","unique","arr","Set","sum","array","numbers","arguments","reduce","prev","current","average","min","Math","max","count","toArray","filter","a","round","num","decimals","isFinite","toLocaleString","useGrouping","maximumFractionDigits","iff","condition","iftrue","iffalse","map","c","ret","replace","haystack","needle","replacement","iterations","item","needleRegex","RegExp","escapeRegExp","counter","len","str","search","toLowerCase","indexOf","starts","ends","join","glue","idify","readable","identifier","$0","$1","$2","toUpperCase","uppercase","lowercase","$now","Date","year","getDateComponent","month","day","weekday","hour","hour12","minute","second","date","twodigit","time","minutes","floor","abs","seconds","hours","days","weeks","months","years","localTimezone","getTimezoneOffset","log","args","console","$","lazy","url","URL","location","searchParams","pair","Object","defineProperty","value","Script","addUnaryOperator","name","o","operand","scalar","addBinaryOperator","symbol","symbols","identity","code","operands","logical","result","b","n","slice","getOperatorName","op","dateA","toDate","dateB","getNumericalOperands","p","r","da","db","details","aliases","subtract","multiply","divide","lt","gt","eq","split","forEach","alias","_Trap","self","Proxy","functions","propertyL","hasOwnProperty","has","$$","number","twodigits","Intl","NumberFormat","minimumIntegerDigits","format","bind","type","timezone","match","local","sign","component","option","locale","document","documentElement","lang","options","extend","getDay","Number","shortname"],"mappings":"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","file":"../mavo.es5.js","sourcesContent":["/**\n * Functions available inside Mavo expressions\n */\n\n(function() {\n\nvar _ = Mavo.Functions = {\n\toperators: {\n\t\t\"=\": \"eq\"\n\t},\n\n\t/**\n\t * Get a property of an object. Used by the . operator to prevent TypeErrors\n\t */\n\tget: function(obj, property) {\n\t\tif (obj && obj[property] !== undefined) {\n\t\t\treturn obj[property];\n\t\t}\n\n\t\tif (Array.isArray(obj) && isNaN(property) && typeof obj[0] === \"object\") {\n\t\t\t// Array and non-numerical property, try by id\n\t\t\tfor (var i=0; i<obj.length; i++) {\n\t\t\t\tif (obj[i] && obj[i].id == property) {\n\t\t\t\t\treturn obj[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Not found :(\n\t\treturn null;\n\t},\n\n\tunique: function(arr) {\n\t\treturn [...new Set(arr)];\n\t},\n\n\t/*********************\n\t * Number functions\n\t *********************/\n\n\t/**\n\t * Aggregate sum\n\t */\n\tsum: function(array) {\n\t\treturn numbers(array, arguments).reduce((prev, current) => {\n\t\t\treturn +prev + (+current || 0);\n\t\t}, 0);\n\t},\n\n\t/**\n\t * Average of an array of numbers\n\t */\n\taverage: function(array) {\n\t\tarray = numbers(array, arguments);\n\n\t\treturn array.length && _.sum(array) / array.length;\n\t},\n\n\t/**\n\t * Min of an array of numbers\n\t */\n\tmin: function(array) {\n\t\treturn Math.min(...numbers(array, arguments));\n\t},\n\n\t/**\n\t * Max of an array of numbers\n\t */\n\tmax: function(array) {\n\t\treturn Math.max(...numbers(array, arguments));\n\t},\n\n\tcount: function(array) {\n\t\treturn Mavo.toArray(array).filter(a => a !== null && a !== false && a !== \"\").length;\n\t},\n\n\tround: function(num, decimals) {\n\t\tif (!num || !decimals || !isFinite(num)) {\n\t\t\treturn Math.round(num);\n\t\t}\n\n\t\treturn +num.toLocaleString(\"en-US\", {\n\t\t\tuseGrouping: false,\n\t\t\tmaximumFractionDigits: decimals\n\t\t});\n\t},\n\n\tiff: function(condition, iftrue, iffalse=\"\") {\n\t\tif (Array.isArray(condition)) {\n\t\t\treturn condition.map((c, i) => {\n\t\t\t\tvar ret = c? iftrue : iffalse;\n\n\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\treturn ret[Math.min(i, ret.length - 1)];\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t});\n\t\t}\n\n\t\treturn condition? iftrue : iffalse;\n\t},\n\n\t/*********************\n\t * String functions\n\t *********************/\n\n\t/**\n\t * Replace all occurences of a string with another string\n\t */\n\treplace: function(haystack, needle, replacement = \"\", iterations = 1) {\n\t\tif (Array.isArray(haystack)) {\n\t\t\treturn haystack.map(item => _.replace(item, needle, replacement));\n\t\t}\n\n\t\t// Simple string replacement\n\t\tvar needleRegex = RegExp(Mavo.escapeRegExp(needle), \"g\");\n\t\tvar ret = haystack, prev;\n\t\tvar counter = 0;\n\n\t\twhile (ret != prev && (counter++ < iterations)) {\n\t\t\tprev = ret;\n\t\t\tret = ret.replace(needleRegex, replacement);\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tlen: str => (str || \"\").length,\n\t/**\n\t * Case insensitive search\n\t */\n\tsearch: (haystack, needle) => haystack && needle? haystack.toLowerCase().indexOf(needle.toLowerCase()) : -1,\n\n\tstarts: (haystack, needle) => _.search((haystack + \"\"), (needle + \"\")) === 0,\n\tends: function(haystack, needle) {\n\t\thaystack += \"\";\n\t\tneedle += \"\";\n\t\tvar i = _.search(haystack, needle);\n\t\treturn  i > -1 && i === haystack.length - needle.length;\n\t},\n\n\tjoin: function(array, glue = \"\") {\n\t\treturn Mavo.toArray(array).join(glue);\n\t},\n\n\tidify: function(readable) {\n\t\treturn ((readable || \"\") + \"\")\n\t\t\t.replace(/\\s+/g, \"-\") // Convert whitespace to hyphens\n\t\t\t.replace(/[^\\w-]/g, \"\") // Remove weird characters\n\t\t\t.toLowerCase();\n\t},\n\n\t// Convert an identifier to readable text that can be used as a label\n\treadable: function (identifier) {\n\t\t// Is it camelCase?\n\t\treturn identifier && identifier\n\t\t\t\t .replace(/([a-z])([A-Z])(?=[a-z])/g, ($0, $1, $2) => $1 + \" \" + $2.toLowerCase()) // camelCase?\n\t\t\t\t .replace(/([a-z])[_\\/-](?=[a-z])/g, \"$1 \") // Hyphen-separated / Underscore_separated?\n\t\t\t\t .replace(/^[a-z]/, $0 => $0.toUpperCase()); // Capitalize\n\t},\n\n\tuppercase: str => (str + \"\").toUpperCase(),\n\tlowercase: str => (str + \"\").toLowerCase(),\n\n\t/*********************\n\t * Date functions\n\t *********************/\n\n\tget $now() {\n\t\treturn new Date();\n\t},\n\n\tyear: getDateComponent(\"year\"),\n\tmonth: getDateComponent(\"month\"),\n\tday: getDateComponent(\"day\"),\n\tweekday: getDateComponent(\"weekday\"),\n\thour: getDateComponent(\"hour\"),\n\thour12: getDateComponent(\"hour\", \"numeric\", {hour12:true}),\n\tminute: getDateComponent(\"minute\"),\n\tsecond: getDateComponent(\"second\"),\n\n\tdate: date => {\n\t\treturn `${_.year(date)}-${_.month(date).twodigit}-${_.day(date).twodigit}`;\n\t},\n\ttime: date => {\n\t\treturn `${_.hour(date).twodigit}:${_.minute(date).twodigit}:${_.second(date).twodigit}`;\n\t},\n\n\tminutes: seconds => Math.floor(Math.abs(seconds) / 60),\n\thours: seconds => Math.floor(Math.abs(seconds) / 3600),\n\tdays: seconds => Math.floor(Math.abs(seconds) / 86400),\n\tweeks: seconds => Math.floor(Math.abs(seconds) / 604800),\n\tmonths: seconds => Math.floor(Math.abs(seconds) / (30.4368 * 86400)),\n\tyears: seconds => Math.floor(Math.abs(seconds) / (30.4368 * 86400 * 12)),\n\n\tlocalTimezone: -(new Date()).getTimezoneOffset(),\n\n\t// Log to the console and return\n\tlog: (...args) => {\n\t\tconsole.log(args);\n\t\treturn args[0];\n\t}\n};\n\n// $url: Read-only syntactic sugar for URL stuff\n$.lazy(Mavo.Functions, \"$url\", function() {\n\tvar ret = {};\n\tvar url = new URL(location);\n\n\tfor (let pair of url.searchParams) {\n\t\tret[pair[0]] = pair[1];\n\t}\n\n\tObject.defineProperty(ret, \"toString\", {\n\t\tvalue: () => new URL(location)\n\t});\n\n\treturn ret;\n});\n\nMavo.Script = {\n\taddUnaryOperator: function(name, o) {\n\t\treturn operand => Array.isArray(operand)? operand.map(o.scalar) : o.scalar(operand);\n\t},\n\n\t/**\n\t * Extend a scalar operator to arrays, or arrays and scalars\n\t * The operation between arrays is applied element-wise.\n\t * The operation operation between a scalar and an array will result in\n\t * the operation being applied between the scalar and every array element.\n\t */\n\taddBinaryOperator: function(name, o) {\n\t\tif (o.symbol) {\n\t\t\t// Build map of symbols to function names for easy rewriting\n\t\t\tfor (let symbol of Mavo.toArray(o.symbol)) {\n\t\t\t\tMavo.Script.symbols[symbol] = name;\n\t\t\t}\n\t\t}\n\n\t\to.identity = o.identity === undefined? 0 : o.identity;\n\n\t\treturn _[name] = o.code || function(...operands) {\n\t\t\tif (operands.length === 1) {\n\t\t\t\tif (Array.isArray(operands[0])) {\n\t\t\t\t\t// Operand is an array of operands, expand it out\n\t\t\t\t\toperands = [...operands[0]];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar prev = o.logical? o.identity : operands[0], result;\n\n\t\t\tfor (let i = 1; i < operands.length; i++) {\n\t\t\t\tlet a = o.logical? operands[i - 1] : prev;\n\t\t\t\tlet b = operands[i];\n\n\t\t\t\tif (Array.isArray(b)) {\n\t\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\t\tb = numbers(b);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\t\tresult = [\n\t\t\t\t\t\t\t...b.map((n, i) => o.scalar(a[i] === undefined? o.identity : a[i], n)),\n\t\t\t\t\t\t\t...a.slice(b.length)\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tresult = b.map(n => o.scalar(a, n));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (Array.isArray(a)) {\n\t\t\t\t\tresult = a.map(n => o.scalar(n, b));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tresult = o.scalar(a, b);\n\t\t\t\t}\n\n\t\t\t\tif (o.reduce) {\n\t\t\t\t\tprev = o.reduce(prev, result, a, b);\n\t\t\t\t}\n\t\t\t\telse if (o.logical) {\n\t\t\t\t\tprev = prev && result;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tprev = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn prev;\n\t\t};\n\t},\n\n\t/**\n\t * Mapping of operator symbols to function name.\n\t * Populated via addOperator() and addLogicalOperator()\n\t */\n\tsymbols: {},\n\n\tgetOperatorName: op => Mavo.Script.symbols[op] || op,\n\n\t/**\n\t * Operations for elements and scalars.\n\t * Operations between arrays happen element-wise.\n\t * Operations between a scalar and an array will result in the operation being performed between the scalar and every array element.\n\t * Ordered by precedence (higher to lower)\n\t * @param scalar {Function} The operation between two scalars\n\t * @param identity The operationâ€™s identity element. Defaults to 0.\n\t */\n\toperators: {\n\t\t\"not\": {\n\t\t\tscalar: a => a => !a\n\t\t},\n\t\t\"multiply\": {\n\t\t\tscalar: (a, b) => a * b,\n\t\t\tidentity: 1,\n\t\t\tsymbol: \"*\"\n\t\t},\n\t\t\"divide\": {\n\t\t\tscalar: (a, b) => a / b,\n\t\t\tidentity: 1,\n\t\t\tsymbol: \"/\"\n\t\t},\n\t\t\"add\": {\n\t\t\tscalar: (a, b) => +a + +b,\n\t\t\tsymbol: \"+\"\n\t\t},\n\t\t\"subtract\": {\n\t\t\tscalar: (a, b) => {\n\t\t\t\tif (isNaN(a) || isNaN(b)) {\n\t\t\t\t\tvar dateA = toDate(a), dateB = toDate(b);\n\n\t\t\t\t\tif (dateA && dateB) {\n\t\t\t\t\t\treturn (dateA - dateB)/1000;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn a - b;\n\t\t\t},\n\t\t\tsymbol: \"-\"\n\t\t},\n\t\t\"mod\": {\n\t\t\tscalar: (a, b) => {\n\t\t\t\tvar ret = a % b;\n\t\t\t\tret += ret < 0? b : 0;\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t},\n\t\t\"lte\": {\n\t\t\tlogical: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\t[a, b] = Mavo.Script.getNumericalOperands(a, b);\n\t\t\t\treturn a <= b;\n\t\t\t},\n\t\t\tidentity: true,\n\t\t\tsymbol: \"<=\"\n\t\t},\n\t\t\"lt\": {\n\t\t\tlogical: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\t[a, b] = Mavo.Script.getNumericalOperands(a, b);\n\t\t\t\treturn a < b;\n\t\t\t},\n\t\t\tidentity: true,\n\t\t\tsymbol: \"<\"\n\t\t},\n\t\t\"gte\": {\n\t\t\tlogical: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\t[a, b] = Mavo.Script.getNumericalOperands(a, b);\n\t\t\t\treturn a >= b;\n\t\t\t},\n\t\t\tidentity: true,\n\t\t\tsymbol: \">=\"\n\t\t},\n\t\t\"gt\": {\n\t\t\tlogical: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\t[a, b] = Mavo.Script.getNumericalOperands(a, b);\n\t\t\t\treturn a > b;\n\t\t\t},\n\t\t\tidentity: true,\n\t\t\tsymbol: \">\"\n\t\t},\n\t\t\"eq\": {\n\t\t\tlogical: true,\n\t\t\tscalar: (a, b) => a == b,\n\t\t\tsymbol: [\"=\", \"==\"],\n\t\t\tidentity: true\n\t\t},\n\t\t\"neq\": {\n\t\t\tlogical: true,\n\t\t\tscalar: (a, b) => a != b,\n\t\t\tsymbol: [\"!=\"],\n\t\t\tidentity: true\n\t\t},\n\t\t\"and\": {\n\t\t\tlogical: true,\n\t\t\tscalar: (a, b) => !!a && !!b,\n\t\t\tidentity: true,\n\t\t\tsymbol: \"&&\"\n\t\t},\n\t\t\"or\": {\n\t\t\tlogical: true,\n\t\t\tscalar: (a, b) => !!a || !!b,\n\t\t\treduce: (p, r) => p || r,\n\t\t\tidentity: false,\n\t\t\tsymbol: \"||\"\n\t\t},\n\t\t\"concatenate\": {\n\t\t\tsymbol: \"&\",\n\t\t\tidentity: \"\",\n\t\t\tscalar: (a, b) => \"\" + (a || \"\") + (b || \"\")\n\t\t},\n\t\t\"filter\": {\n\t\t\tscalar: (a, b) => b? a : null\n\t\t}\n\t},\n\n\tgetNumericalOperands: function(a, b) {\n\t\tif (isNaN(a) || isNaN(b)) {\n\t\t\t// Try comparing as dates\n\t\t\tvar da = toDate(a), db = toDate(b);\n\n\t\t\tif (da && db) {\n\t\t\t\t// Both valid dates\n\t\t\t\treturn [da, db];\n\t\t\t}\n\t\t}\n\n\t\treturn [a, b];\n\t}\n};\n\nfor (let name in Mavo.Script.operators) {\n\tlet details = Mavo.Script.operators[name];\n\n\tif (details.scalar.length < 2) {\n\t\tMavo.Script.addUnaryOperator(name, details);\n\t}\n\telse {\n\t\tMavo.Script.addBinaryOperator(name, details);\n\t}\n}\n\nvar aliases = {\n\taverage: \"avg\",\n\tiff: \"iff IF\",\n\tsubtract: \"minus\",\n\tmultiply: \"mult product\",\n\tdivide: \"div\",\n\tlt: \"lessThan smaller\",\n\tgt: \"moreThan greater greaterThan bigger\",\n\teq: \"equal equality\"\n};\n\nfor (let name in aliases) {\n\taliases[name].split(/\\s+/g).forEach(alias => _[alias] = _[name]);\n}\n\n// Make function names case insensitive\nMavo.Functions._Trap = self.Proxy? new Proxy(_, {\n\tget: (functions, property) => {\n\t\tif (property in functions) {\n\t\t\treturn functions[property];\n\t\t}\n\n\t\tvar propertyL = property.toLowerCase && property.toLowerCase();\n\n\t\tif (propertyL && functions.hasOwnProperty(propertyL)) {\n\t\t\treturn functions[propertyL];\n\t\t}\n\n\t\tif (property in Math || propertyL in Math) {\n\t\t\treturn Math[property] || Math[propertyL];\n\t\t}\n\n\t\tif (property in self) {\n\t\t\treturn self[property];\n\t\t}\n\n\t\t// Prevent undefined at all costs\n\t\treturn property;\n\t},\n\n\t// Super ugly hack, but otherwise data is not\n\t// the local variable it should be, but the string \"data\"\n\t// so all property lookups fail.\n\thas: (functions, property) => property != \"data\"\n}) : Mavo.Functions;\n\n/**\n * Private helper methods\n */\nfunction numbers(array, args) {\n\tarray = Array.isArray(array)? array : (args? $$(args) : [array]);\n\n\treturn array.filter(number => !isNaN(number) && number !== \"\").map(n => +n);\n}\n\nvar twodigits = new Intl.NumberFormat(\"en\", {\n\tminimumIntegerDigits: \"2\"\n});\n\ntwodigits = twodigits.format.bind(twodigits);\n\nfunction toDate(date) {\n\tif (!date) {\n\t\treturn null;\n\t}\n\n\tif ($.type(date) === \"string\") {\n\t\t// Fix up time format\n\n\t\tif (date.indexOf(\":\") === -1) {\n\t\t\t// Add a time if one doesn't exist\n\t\t\tdate += \"T00:00:00\";\n\t\t}\n\t\telse {\n\t\t\t// Make sure time starts with T, due to Safari bug\n\t\t\tdate = date.replace(/\\-(\\d{2})\\s+(?=\\d{2}:)/, \"-$1T\");\n\t\t}\n\n\t\t// Remove all whitespace\n\t\tdate = date.replace(/\\s+/g, \"\");\n\n\t\t// If no timezone, insert local\n\t\tvar timezone = (date.match(/[+-]\\d{2}:?\\d{2}|Z$/) || [])[0];\n\n\t\tif (!timezone) {\n\t\t\tvar local = _.localTimezone;\n\t\t\tvar minutes = Math.abs(local % 60);\n\t\t\tvar hours = (Math.abs(local) - minutes) / 60;\n\t\t\tvar sign = local < 0? \"-\" : \"+\";\n\t\t\tdate += sign + twodigits(hours) + \":\" + twodigits(minutes);\n\t\t}\n\t}\n\n\tdate = new Date(date);\n\n\tif (isNaN(date)) {\n\t\treturn null;\n\t}\n\n\treturn date;\n}\n\nfunction getDateComponent(component, option = \"numeric\", o) {\n\tvar locale = document.documentElement.lang || \"en-GB\";\n\n\treturn function(date, format = option) {\n\t\tdate = toDate(date);\n\n\t\tif (!date) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tvar options = $.extend({\n\t\t\t[component]: format,\n\t\t\thour12: false\n\t\t}, o);\n\n\t\tif (component == \"weekday\" && format == \"numeric\") {\n\t\t\tret = date.getDay() || 7;\n\t\t}\n\t\telse {\n\t\t\tvar ret = date.toLocaleString(locale, options);\n\t\t}\n\n\t\tif (format == \"numeric\" && !isNaN(ret)) {\n\t\t\tret = new Number(ret);\n\n\t\t\tif (component == \"month\" || component == \"weekday\") {\n\t\t\t\toptions[component] = \"long\";\n\t\t\t\tret.name = date.toLocaleString(locale, options);\n\n\t\t\t\toptions[component] = \"short\";\n\t\t\t\tret.shortname = date.toLocaleString(locale, options);\n\t\t\t}\n\n\t\t\tif (component != \"weekday\") {\n\t\t\t\toptions[component] = \"2-digit\";\n\t\t\t\tret.twodigit = date.toLocaleString(locale, options);\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\t};\n}\n\n})();\n"]}